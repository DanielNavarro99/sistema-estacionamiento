<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario - Estacionamiento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white text-center">
                        <h4>üöò Crear Cuenta de Usuario</h4>
                    </div>
                    <div class="card-body">
                        <form id="formRegistro">
                            
                            <h5 class="text-secondary border-bottom pb-2">Datos del Conductor</h5>
                            <div class="mb-3">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" id="nombre" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Correo Electr√≥nico</label>
                                <input type="email" id="email" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Contrase√±a</label>
                                <input type="password" id="password" class="form-control" required>
                            </div>

                            <h5 class="text-secondary border-bottom pb-2 mt-4">Datos del Veh√≠culo</h5>
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label class="form-label">Tipo</label>
                                    <select id="tipo_vehiculo" class="form-select">
                                        <option value="Automovil">Autom√≥vil</option>
                                        <option value="Motocicleta">Motocicleta</option>
                                        <option value="Camioneta">Camioneta</option>
                                    </select>
                                </div>
                                <div class="col-6 mb-3">
                                    <label class="form-label">Marca</label>
                                    <input type="text" id="marca" class="form-control" placeholder="Ej: Nissan">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Placa</label>
                                <input type="text" id="placa" class="form-control text-uppercase" required placeholder="Ej: JAL-123">
                            </div>

                            <button type="submit" id="btnRegistrar" class="btn btn-primary w-100 mt-3">Registrar Usuario</button>
                            
                            <a href="vistaUsuario2.html" id="btnSiguiente" class="btn btn-success w-100 mt-3 d-none">
                                Siguiente ‚û°Ô∏è
                            </a>

                        </form>
                        
                        <div id="mensaje" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('formRegistro').addEventListener('submit', async function(e) {
            e.preventDefault();

            const datos = {
                nombre: document.getElementById('nombre').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                tipo_vehiculo: document.getElementById('tipo_vehiculo').value,
                marca_vehiculo: document.getElementById('marca').value,
                placa: document.getElementById('placa').value
            };

            const divMensaje = document.getElementById('mensaje');
            const btnSiguiente = document.getElementById('btnSiguiente'); 
            const btnRegistrar = document.getElementById('btnRegistrar'); 

            // --- INICIO DE CARGA Y DESHABILITAR BOT√ìN (Mejora) ---
            divMensaje.innerHTML = `<div class="alert alert-info">‚è≥ Registrando...</div>`;
            btnRegistrar.disabled = true;
            btnRegistrar.innerHTML = 'Registrando...'; // Opcional, cambiar el texto del bot√≥n
            // ----------------------------------------------------

            try {
                const respuesta = await fetch('http://localhost:3000/api/auth/registro', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });

                const resultado = await respuesta.json();

                if (respuesta.ok) {
                    // CASO DE √âXITO:
                    divMensaje.innerHTML = `<div class="alert alert-success">‚úÖ ${resultado.mensaje}</div>`;
                    
                    // 1. Limpiamos el formulario
                    document.getElementById('formRegistro').reset(); 
                    
                    // 2. Ocultamos el bot√≥n de registrar y mostramos el de Siguiente
                    btnRegistrar.style.display = 'none';
                    btnSiguiente.classList.remove('d-none');
                    
                    // Opcional: Redirecci√≥n autom√°tica despu√©s de un tiempo
                    // setTimeout(() => {
                    //     window.location.href = 'vistaUsuario2.html';
                    // }, 1500); 

                } else {
                    // CASO DE ERROR:
                    divMensaje.innerHTML = `<div class="alert alert-danger">‚ùå ${resultado.error || 'Error de servidor desconocido.'}</div>`;
                    
                    // Mantenemos visible el bot√≥n Registrar y oculto Siguiente
                    btnSiguiente.classList.add('d-none');
                    btnRegistrar.style.display = 'block';
                    
                }
            } catch (error) {
                console.error(error);
                divMensaje.innerHTML = `<div class="alert alert-danger">üî• Error de conexi√≥n. Verifica que el servidor Node est√© activo.</div>`;
            } finally {
                // --- FIN DE CARGA ---
                btnRegistrar.disabled = false;
                btnRegistrar.innerHTML = 'Registrar Usuario'; // Devolver el texto original
                // ---------------------
            }
        });
    </script>
</body>
</html>